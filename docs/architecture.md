# ğŸ—ï¸ ARQUITETURA TÃ‰CNICA - FLAME LOUNGE

**VersÃ£o:** 2.0
**Ãšltima AtualizaÃ§Ã£o:** 2026-01-16
**Status:** ProduÃ§Ã£o

---

## ğŸ“‹ Ãndice

- [VisÃ£o Geral](#visÃ£o-geral)
- [Arquitetura de Alto NÃ­vel](#arquitetura-de-alto-nÃ­vel)
- [Stack TecnolÃ³gico](#stack-tecnolÃ³gico)
- [Frontend Architecture](#frontend-architecture)
- [Backend Architecture](#backend-architecture)
- [Database Architecture](#database-architecture)
- [Real-time Communication](#real-time-communication)
- [Security Architecture](#security-architecture)
- [Deployment Architecture](#deployment-architecture)
- [Fluxos de Dados](#fluxos-de-dados)
- [DecisÃµes Arquiteturais](#decisÃµes-arquiteturais)

---

## ğŸ¯ VisÃ£o Geral

O FLAME Lounge Ã© uma aplicaÃ§Ã£o **full-stack moderna** construÃ­da com arquitetura **cliente-servidor** separada, comunicaÃ§Ã£o **real-time** via WebSockets, e design **mobile-first** com suporte PWA.

### CaracterÃ­sticas Principais

- âœ… **SeparaÃ§Ã£o Front/Back** - Deploys independentes
- âœ… **Real-time** - Socket.io para updates instantÃ¢neos
- âœ… **Progressive Web App** - InstalÃ¡vel e funciona offline
- âœ… **RESTful API** - Arquitetura baseada em recursos
- âœ… **AutenticaÃ§Ã£o JWT** - Stateless e escalÃ¡vel
- âœ… **Database ORM** - Sequelize com migraÃ§Ãµes versionadas

---

## ğŸ›ï¸ Arquitetura de Alto NÃ­vel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAMADA DE USUÃRIOS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Clientes  â”‚   GarÃ§ons   â”‚   Cozinha    â”‚   Administradores   â”‚
â”‚  (Mobile)   â”‚  (Tablet)   â”‚   (KDS)      â”‚    (Desktop)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LOAD BALANCER                            â”‚
â”‚                    (Vercel Edge Network)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (Next.js 14)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ SSR/SSG Pages (50+ routes)                                   â”‚
â”‚  â€¢ React Components (45+)                                        â”‚
â”‚  â€¢ Zustand State Management (17 stores)                         â”‚
â”‚  â€¢ Service Worker (PWA)                                          â”‚
â”‚  â€¢ Socket.io Client (Real-time)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Gateway   â”‚
                    â”‚  (Express.js)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND (Express.js)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Controllers â”‚  â”‚   Services   â”‚  â”‚     Jobs     â”‚         â”‚
â”‚  â”‚    (API)     â”‚  â”‚  (Business)  â”‚  â”‚  (Cron)      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â–¼                  â–¼                  â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚     Auth     â”‚  â”‚    Socket    â”‚  â”‚  Webhooks    â”‚         â”‚
â”‚  â”‚ Middleware   â”‚  â”‚   Handler    â”‚  â”‚   (Stripe)   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA ACCESS LAYER (ORM)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sequelize ORM â€¢ 18 Models â€¢ Migrations â€¢ Associations          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATABASE (PostgreSQL)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Railway â€¢ Primary + Replica â€¢ Automated Backups                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL SERVICES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Stripe    â”‚   SendGrid   â”‚    Twilio    â”‚   Cloudinary     â”‚
â”‚  (Payments)  â”‚   (Email)    â”‚    (SMS)     â”‚   (Images)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Stack TecnolÃ³gico

### Frontend Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PRESENTATION LAYER               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Next.js 14.0.4 (React 18.2.0)             â”‚
â”‚ â€¢ App Router                               â”‚
â”‚ â€¢ SSR/SSG/ISR                              â”‚
â”‚ â€¢ Image Optimization                       â”‚
â”‚ â€¢ API Routes (if needed)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STATE MANAGEMENT                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Zustand 4.4.7                              â”‚
â”‚ â€¢ authStore                                â”‚
â”‚ â€¢ cartStore                                â”‚
â”‚ â€¢ orderStore                               â”‚
â”‚ â€¢ ... (17 stores total)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DATA FETCHING                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ React Query 3.39.3 + Axios 1.6.2           â”‚
â”‚ â€¢ Caching                                  â”‚
â”‚ â€¢ Retry logic                              â”‚
â”‚ â€¢ Optimistic updates                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI LAYER                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tailwind CSS 3.3.6                         â”‚
â”‚ â€¢ Utility-first                            â”‚
â”‚ â€¢ Responsive breakpoints                   â”‚
â”‚ â€¢ Custom design tokens                     â”‚
â”‚                                            â”‚
â”‚ Component Libraries:                       â”‚
â”‚ â€¢ Heroicons 2.0.18                         â”‚
â”‚ â€¢ Lucide React 0.544.0                     â”‚
â”‚ â€¢ Framer Motion 10.16.16                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Express.js 4.18.2                          â”‚
â”‚ â€¢ RESTful routes (~20)                     â”‚
â”‚ â€¢ Middleware chain                         â”‚
â”‚ â€¢ Error handling                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       AUTHENTICATION & SECURITY            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JWT (jsonwebtoken 9.0.2)                   â”‚
â”‚ bcryptjs 2.4.3                             â”‚
â”‚ Helmet 7.1.0                               â”‚
â”‚ express-rate-limit 7.1.5                   â”‚
â”‚ CORS                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BUSINESS LOGIC                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Services (16 modules)                      â”‚
â”‚ â€¢ OrderService                             â”‚
â”‚ â€¢ PaymentService                           â”‚
â”‚ â€¢ CashbackService                          â”‚
â”‚ â€¢ ... etc                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DATA LAYER                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Sequelize 6.35.2                           â”‚
â”‚ â€¢ Models (18)                              â”‚
â”‚ â€¢ Migrations (15)                          â”‚
â”‚ â€¢ Associations                             â”‚
â”‚ â€¢ Validations                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» Frontend Architecture

### Estrutura de DiretÃ³rios

```
frontend/src/
â”œâ”€â”€ pages/                    # Next.js Routes (51 pages)
â”‚   â”œâ”€â”€ index.js             # Landing page
â”‚   â”œâ”€â”€ cardapio/            # Menu pages
â”‚   â”œâ”€â”€ pedidos/             # Orders
â”‚   â”œâ”€â”€ reservas/            # Reservations
â”‚   â”œâ”€â”€ admin/               # Admin dashboard
â”‚   â””â”€â”€ staff/               # Staff area
â”‚
â”œâ”€â”€ components/              # React Components (45+)
â”‚   â”œâ”€â”€ Admin/              # Admin components
â”‚   â”œâ”€â”€ Auth/               # Login, Register
â”‚   â”œâ”€â”€ Cart/               # Shopping cart
â”‚   â”œâ”€â”€ Checkout/           # Payment flow
â”‚   â”œâ”€â”€ Landing/            # Home page
â”‚   â”œâ”€â”€ Menu/               # Menu display
â”‚   â”œâ”€â”€ Tracking/           # Order tracking
â”‚   â””â”€â”€ ui/                 # Base components (Button, Input, etc)
â”‚
â”œâ”€â”€ stores/                  # Zustand Stores (17)
â”‚   â”œâ”€â”€ authStore.js        # Authentication state
â”‚   â”œâ”€â”€ cartStore.js        # Shopping cart
â”‚   â”œâ”€â”€ orderStore.js       # Orders
â”‚   â”œâ”€â”€ reservationStore.js # Reservations
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ hooks/                   # Custom React Hooks (6)
â”‚   â”œâ”€â”€ useAuth.js
â”‚   â”œâ”€â”€ useCart.js
â”‚   â”œâ”€â”€ useSocket.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ services/                # API Clients
â”‚   â”œâ”€â”€ api.js              # Axios instance
â”‚   â”œâ”€â”€ authService.js
â”‚   â”œâ”€â”€ orderService.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ utils/                   # Utilities
â”‚   â”œâ”€â”€ formatters.js
â”‚   â”œâ”€â”€ validators.js
â”‚   â””â”€â”€ constants.js
â”‚
â””â”€â”€ styles/                  # Global styles
    â”œâ”€â”€ globals.css
    â””â”€â”€ tailwind.config.js
```

### Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PAGE COMPONENT                     â”‚
â”‚  (Next.js Route - SSR/SSG)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Data fetching (getServerSideProps)           â”‚
â”‚  â€¢ SEO metadata                                 â”‚
â”‚  â€¢ Layout composition                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CONTAINER COMPONENTS                   â”‚
â”‚  (Business Logic)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Zustand stores connection                    â”‚
â”‚  â€¢ React Query hooks                            â”‚
â”‚  â€¢ Event handlers                               â”‚
â”‚  â€¢ State management                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PRESENTATIONAL COMPONENTS                â”‚
â”‚  (Pure UI)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Props-based                                  â”‚
â”‚  â€¢ No business logic                            â”‚
â”‚  â€¢ Reusable                                     â”‚
â”‚  â€¢ Styled with Tailwind                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Management (Zustand)

```javascript
// Example: cartStore.js
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CART STORE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ State:                              â”‚
â”‚  â€¢ items: []                        â”‚
â”‚  â€¢ total: 0                         â”‚
â”‚  â€¢ isOpen: false                    â”‚
â”‚                                     â”‚
â”‚ Actions:                            â”‚
â”‚  â€¢ addItem(product, quantity)       â”‚
â”‚  â€¢ removeItem(productId)            â”‚
â”‚  â€¢ updateQuantity(id, qty)          â”‚
â”‚  â€¢ clearCart()                      â”‚
â”‚  â€¢ openCart() / closeCart()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Backend Architecture

### Estrutura de DiretÃ³rios

```
backend/src/
â”œâ”€â”€ models/                  # Sequelize Models (18)
â”‚   â”œâ”€â”€ User.js
â”‚   â”œâ”€â”€ Product.js
â”‚   â”œâ”€â”€ Order.js
â”‚   â”œâ”€â”€ OrderItem.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ controllers/             # Request Handlers (~15)
â”‚   â”œâ”€â”€ authController.js
â”‚   â”œâ”€â”€ orderController.js
â”‚   â”œâ”€â”€ productController.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ services/                # Business Logic (16)
â”‚   â”œâ”€â”€ authService.js
â”‚   â”œâ”€â”€ orderService.js
â”‚   â”œâ”€â”€ paymentService.js
â”‚   â”œâ”€â”€ cashbackService.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ routes/                  # Express Routes (~20)
â”‚   â”œâ”€â”€ index.js            # Route aggregator
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ orders.js
â”‚   â”œâ”€â”€ products.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ middlewares/             # Middleware Chain
â”‚   â”œâ”€â”€ auth.js             # JWT verification
â”‚   â”œâ”€â”€ validate.js         # Input validation
â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â””â”€â”€ rateLimit.js
â”‚
â”œâ”€â”€ migrations/              # Database Migrations (15)
â”‚   â”œâ”€â”€ 001-create-users.js
â”‚   â”œâ”€â”€ 002-create-products.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ jobs/                    # Scheduled Tasks (7)
â”‚   â”œâ”€â”€ stockAlerts.js
â”‚   â”œâ”€â”€ reservationReminders.js
â”‚   â”œâ”€â”€ cashbackExpiry.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ database/                # DB Configuration
â”‚   â”œâ”€â”€ config.js
â”‚   â””â”€â”€ connection.js
â”‚
â”œâ”€â”€ utils/                   # Helpers
â”‚   â”œâ”€â”€ logger.js
â”‚   â”œâ”€â”€ qrcode.js
â”‚   â””â”€â”€ notifications.js
â”‚
â””â”€â”€ server.js                # Entry Point
```

### Request Flow

```
1. HTTP Request
        â–¼
2. Rate Limiting Middleware
        â–¼
3. CORS Middleware
        â–¼
4. Body Parser
        â–¼
5. Route Matching
        â–¼
6. Auth Middleware (if protected)
        â–¼
7. Validation Middleware
        â–¼
8. Controller
        â–¼
9. Service (Business Logic)
        â–¼
10. Model (Database)
        â–¼
11. Response
```

### API Architecture (RESTful)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REST API ENDPOINTS                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ /api/auth                                      â”‚
â”‚  â”œâ”€ POST   /register                          â”‚
â”‚  â”œâ”€ POST   /login                             â”‚
â”‚  â”œâ”€ POST   /refresh                           â”‚
â”‚  â””â”€ POST   /logout                            â”‚
â”‚                                                â”‚
â”‚ /api/products                                  â”‚
â”‚  â”œâ”€ GET    /                                  â”‚
â”‚  â”œâ”€ GET    /:id                               â”‚
â”‚  â”œâ”€ POST   /           (admin)                â”‚
â”‚  â”œâ”€ PUT    /:id        (admin)                â”‚
â”‚  â””â”€ DELETE /:id        (admin)                â”‚
â”‚                                                â”‚
â”‚ /api/orders                                    â”‚
â”‚  â”œâ”€ GET    /                                  â”‚
â”‚  â”œâ”€ GET    /:id                               â”‚
â”‚  â”œâ”€ POST   /                                  â”‚
â”‚  â”œâ”€ PATCH  /:id/status                        â”‚
â”‚  â””â”€ DELETE /:id                               â”‚
â”‚                                                â”‚
â”‚ /api/reservations                              â”‚
â”‚  â”œâ”€ GET    /                                  â”‚
â”‚  â”œâ”€ GET    /:id                               â”‚
â”‚  â”œâ”€ POST   /                                  â”‚
â”‚  â”œâ”€ PATCH  /:id                               â”‚
â”‚  â””â”€ DELETE /:id                               â”‚
â”‚                                                â”‚
â”‚ /api/cashback                                  â”‚
â”‚  â”œâ”€ GET    /balance                           â”‚
â”‚  â”œâ”€ GET    /history                           â”‚
â”‚  â””â”€ POST   /redeem                            â”‚
â”‚                                                â”‚
â”‚ ... (20+ routes total)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Architecture

### Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤    Order     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Table     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  1:N    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   N:1   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚         â”‚ id           â”‚         â”‚ id          â”‚
â”‚ name        â”‚         â”‚ userId       â”‚         â”‚ number      â”‚
â”‚ email       â”‚         â”‚ tableId      â”‚         â”‚ capacity    â”‚
â”‚ password    â”‚         â”‚ total        â”‚         â”‚ status      â”‚
â”‚ phone       â”‚         â”‚ status       â”‚         â”‚ qrCode      â”‚
â”‚ role        â”‚         â”‚ createdAt    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ tier        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ cashback    â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ 1:N
       â”‚                      â–¼
       â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚  OrderItem   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Product   â”‚
       â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   N:1   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚               â”‚ id           â”‚         â”‚ id          â”‚
       â”‚               â”‚ orderId      â”‚         â”‚ name        â”‚
       â”‚               â”‚ productId    â”‚         â”‚ description â”‚
       â”‚               â”‚ quantity     â”‚         â”‚ price       â”‚
       â”‚               â”‚ price        â”‚         â”‚ categoryId  â”‚
       â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ image       â”‚
       â”‚                                        â”‚ isActive    â”‚
       â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1:N                                          â”‚
       â–¼                                              â”‚ N:1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â–¼
â”‚ Reservation  â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚  Category   â”‚
â”‚ id           â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ userId       â”‚                              â”‚ id          â”‚
â”‚ tableId      â”‚                              â”‚ name        â”‚
â”‚ date         â”‚                              â”‚ description â”‚
â”‚ time         â”‚                              â”‚ image       â”‚
â”‚ guests       â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ status       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CashbackHist  â”‚         â”‚  Ingredient  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚         â”‚ id           â”‚
â”‚ userId       â”‚         â”‚ name         â”‚
â”‚ orderId      â”‚         â”‚ unit         â”‚
â”‚ amount       â”‚         â”‚ quantity     â”‚
â”‚ type         â”‚         â”‚ minStock     â”‚
â”‚ expiresAt    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                â”‚ N:M
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  RecipeItem  â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ productId    â”‚
                         â”‚ ingredientId â”‚
                         â”‚ quantity     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Models (18 total)

1. **User** - Clientes, garÃ§ons, admin
2. **Product** - Produtos do cardÃ¡pio
3. **Category** - Categorias de produtos
4. **Table** - Mesas do restaurante
5. **Order** - Pedidos
6. **OrderItem** - Itens dos pedidos
7. **Reservation** - Reservas de mesa
8. **HookahSession** - SessÃµes de narguilÃ©
9. **HookahFlavor** - Sabores de narguilÃ©
10. **Cashier** - Caixa
11. **CashierMovement** - MovimentaÃ§Ãµes do caixa
12. **CashbackHistory** - HistÃ³rico de cashback
13. **Campaign** - Campanhas de marketing
14. **Ingredient** - Ingredientes
15. **RecipeItem** - Receitas (produtos â†” ingredientes)
16. **InventoryMovement** - MovimentaÃ§Ã£o de estoque
17. **Message** - Mensagens/notificaÃ§Ãµes
18. **SplitPayment** - DivisÃ£o de conta
19. **InstagramCashback** - Cashback por Instagram
20. **PushSubscription** - InscriÃ§Ãµes push

---

## ğŸ”„ Real-time Communication

### Socket.io Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SOCKET.IO SERVER                    â”‚
â”‚            (Backend: Port 5000)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  Namespaces:                                 â”‚
â”‚  â”œâ”€ /orders    (Pedidos)                     â”‚
â”‚  â”œâ”€ /kitchen   (Cozinha)                     â”‚
â”‚  â”œâ”€ /tracking  (Rastreamento)                â”‚
â”‚  â””â”€ /admin     (Admin dashboard)             â”‚
â”‚                                              â”‚
â”‚  Events Emitted:                             â”‚
â”‚  â”œâ”€ order:created                            â”‚
â”‚  â”œâ”€ order:updated                            â”‚
â”‚  â”œâ”€ order:status_changed                     â”‚
â”‚  â”œâ”€ kitchen:new_order                        â”‚
â”‚  â””â”€ table:call_waiter                        â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–²         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SOCKET.IO CLIENTS                     â”‚
â”‚         (Frontend: Multiple)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Client Page         â”‚  Listens To           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Order Tracking      â”‚  order:status_changed â”‚
â”‚  Kitchen Dashboard   â”‚  kitchen:new_order    â”‚
â”‚  Admin Dashboard     â”‚  order:created        â”‚
â”‚  Waiter Tablet       â”‚  table:call_waiter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Real-time Flow Example: New Order

```
1. Cliente finaliza pedido (Frontend)
        â–¼
2. POST /api/orders (REST API)
        â–¼
3. Order salvo no Database
        â–¼
4. Socket.io emite eventos:
   â”œâ”€ "order:created" â†’ Admin Dashboard
   â”œâ”€ "kitchen:new_order" â†’ Kitchen Display
   â””â”€ "order:status_changed" â†’ Client Tracking
        â–¼
5. Clientes recebem updates em tempo real
```

---

## ğŸ” Security Architecture

### Authentication Flow (JWT)

```
1. User Login (email + password)
        â–¼
2. Backend valida credenciais
        â–¼
3. Gera JWT token (access + refresh)
        â–¼
4. Token armazenado no cookie httpOnly
        â–¼
5. Requests subsequentes incluem token no header
        â–¼
6. Middleware valida JWT em rotas protegidas
        â–¼
7. Se vÃ¡lido, anexa user ao req.user
```

### Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SECURITY LAYERS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ 1. Rate Limiting                           â”‚
â”‚    â€¢ 500 requests / 15min por IP          â”‚
â”‚    â€¢ ProteÃ§Ã£o contra brute force          â”‚
â”‚                                            â”‚
â”‚ 2. CORS                                    â”‚
â”‚    â€¢ Whitelist de origens permitidas      â”‚
â”‚    â€¢ Credentials habilitado               â”‚
â”‚                                            â”‚
â”‚ 3. Helmet                                  â”‚
â”‚    â€¢ Security headers (XSS, CSP, etc)     â”‚
â”‚                                            â”‚
â”‚ 4. Input Validation                        â”‚
â”‚    â€¢ express-validator                     â”‚
â”‚    â€¢ SanitizaÃ§Ã£o de inputs                â”‚
â”‚                                            â”‚
â”‚ 5. Password Hashing                        â”‚
â”‚    â€¢ bcryptjs (12 rounds)                 â”‚
â”‚                                            â”‚
â”‚ 6. JWT Authentication                      â”‚
â”‚    â€¢ Tokens com expiraÃ§Ã£o                 â”‚
â”‚    â€¢ Refresh token rotation               â”‚
â”‚                                            â”‚
â”‚ 7. SQL Injection Protection                â”‚
â”‚    â€¢ Sequelize ORM (prepared statements)  â”‚
â”‚                                            â”‚
â”‚ 8. HTTPS                                   â”‚
â”‚    â€¢ ForÃ§ado em produÃ§Ã£o                  â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš¢ Deployment Architecture

### Production Infrastructure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VERCEL (FRONTEND)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Edge Network (CDN global)                               â”‚
â”‚  â€¢ Auto-scaling                                            â”‚
â”‚  â€¢ SSL/TLS automÃ¡tico                                      â”‚
â”‚  â€¢ GitHub integration (CI/CD)                              â”‚
â”‚  â€¢ Environment variables                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                          â”‚ HTTPS
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CLIENTE (Browser/PWA)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼ REST API / WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RAILWAY (BACKEND)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Container:                                                â”‚
â”‚  â”œâ”€ Node.js 18                                             â”‚
â”‚  â”œâ”€ Express Server                                         â”‚
â”‚  â”œâ”€ Socket.io Server                                       â”‚
â”‚  â””â”€ Cron Jobs                                              â”‚
â”‚                                                            â”‚
â”‚  Features:                                                 â”‚
â”‚  â”œâ”€ Auto-scaling                                           â”‚
â”‚  â”œâ”€ Health checks                                          â”‚
â”‚  â”œâ”€ Rollback capability                                    â”‚
â”‚  â””â”€ GitHub integration (CI/CD)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RAILWAY POSTGRESQL DATABASE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Primary + Replica                                       â”‚
â”‚  â€¢ Automated backups (daily)                               â”‚
â”‚  â€¢ Connection pooling                                      â”‚
â”‚  â€¢ SSL enforced                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deployment Flow

```
Developer Push
    â–¼
GitHub Repository
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CI/CD Trigger  â”‚
â”‚  (GitHub Push)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Build & Test                 â”‚
â”‚    â€¢ npm install                â”‚
â”‚    â€¢ npm run lint               â”‚
â”‚    â€¢ npm test                   â”‚
â”‚    â€¢ npm run build              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Deploy                       â”‚
â”‚    Frontend â†’ Vercel            â”‚
â”‚    Backend â†’ Railway            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Health Check                 â”‚
â”‚    â€¢ /health endpoint           â”‚
â”‚    â€¢ Smoke tests                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
Production Live âœ…
```

---

## ğŸ“Š Fluxos de Dados

### Fluxo: Criar Pedido

```
[Cliente] â†’ [Frontend]
              â”‚
              â–¼
        Adiciona itens ao carrinho
              â”‚
              â–¼
        Clica em "Finalizar Pedido"
              â”‚
              â–¼
        POST /api/orders
              â”‚
              â–¼
         [Backend]
              â”‚
         1. Valida request
         2. Verifica estoque
         3. Calcula total + cashback
         4. Cria Order + OrderItems
         5. Atualiza estoque
         6. Emite Socket.io events
         7. Retorna order ID
              â”‚
              â–¼
         [Frontend]
              â”‚
         Limpa carrinho
         Redireciona para /pedidos/:id
         Conecta Socket.io (tracking)
              â”‚
              â–¼
         [Real-time Updates]
              â”‚
         â€¢ Status: "pending" â†’ "confirmed"
         â€¢ Status: "preparing" â†’ "ready"
         â€¢ NotificaÃ§Ã£o push
```

### Fluxo: Sistema de Cashback

```
[Cliente faz pedido de R$ 100]
              â”‚
              â–¼
    [Backend - PaymentService]
              â”‚
         1. Calcula cashback baseado no tier
            â€¢ Bronze: 2% = R$ 2
            â€¢ Silver: 5% = R$ 5
            â€¢ Gold: 8% = R$ 8
            â€¢ Platinum: 10% = R$ 10
              â”‚
         2. Cria registro CashbackHistory
              â”‚
         3. Atualiza User.cashbackBalance
              â”‚
         4. Verifica se mudou de tier
              â”‚
         5. Envia notificaÃ§Ã£o
              â”‚
              â–¼
    [Frontend - Cashback Badge]
              â”‚
         Exibe: "VocÃª ganhou R$ 5 de cashback!"
```

---

## ğŸ§© DecisÃµes Arquiteturais

### 1. Por que Next.js?

**DecisÃ£o:** Next.js 14 com App Router

**RazÃµes:**
- âœ… SSR/SSG out-of-the-box (SEO)
- âœ… Image optimization automÃ¡tica
- âœ… Code splitting automÃ¡tico
- âœ… API routes (se necessÃ¡rio)
- âœ… Vercel deployment otimizado
- âœ… DX excelente

**Alternativas consideradas:**
- âŒ Create React App (sem SSR)
- âŒ Remix (mais novo, menos maduro)
- âŒ Gatsby (overkill para nÃ£o-blog)

### 2. Por que Zustand para state?

**DecisÃ£o:** Zustand 4.4.7

**RazÃµes:**
- âœ… API simples e minimalista
- âœ… Sem boilerplate (vs Redux)
- âœ… Performance excelente
- âœ… Bundle size pequeno (3KB)
- âœ… Suporta persist middleware

**Alternativas consideradas:**
- âŒ Redux (muito boilerplate)
- âŒ MobX (menos popular)
- âŒ Jotai/Recoil (atomic, complexo)

### 3. Por que Sequelize?

**DecisÃ£o:** Sequelize 6.35.2

**RazÃµes:**
- âœ… ORM maduro e estÃ¡vel
- âœ… Suporta PostgreSQL + SQLite
- âœ… Migrations versionadas
- âœ… Associations complexas
- âœ… DocumentaÃ§Ã£o extensa

**Alternativas consideradas:**
- âŒ Prisma (migraÃ§Ã£o futura possÃ­vel)
- âŒ TypeORM (menos maduro)
- âŒ Knex.js (query builder, nÃ£o ORM)

### 4. Por que Socket.io?

**DecisÃ£o:** Socket.io 4.7.5

**RazÃµes:**
- âœ… Real-time bidirecional
- âœ… Fallback automÃ¡tico (polling)
- âœ… Room/namespace support
- âœ… Reconnection automÃ¡tica
- âœ… Binary data support

**Alternativas consideradas:**
- âŒ Server-Sent Events (unidirecional)
- âŒ WebSockets puro (sem fallback)
- âŒ Firebase (vendor lock-in)

### 5. Por que Railway?

**DecisÃ£o:** Railway para backend + database

**RazÃµes:**
- âœ… PostgreSQL integrado
- âœ… Deploy automÃ¡tico via Git
- âœ… Logs e monitoring
- âœ… VariÃ¡veis de ambiente
- âœ… PreÃ§o competitivo

**Alternativas consideradas:**
- âŒ Heroku (mais caro)
- âŒ AWS (mais complexo)
- âŒ DigitalOcean (requer mais setup)

---

## ğŸ“ˆ Escalabilidade

### Horizontal Scaling

```
Load Balancer
      â”‚
      â”œâ”€ Frontend Instance 1 (Vercel Edge)
      â”œâ”€ Frontend Instance 2 (Vercel Edge)
      â””â”€ Frontend Instance N (Vercel Edge)

      â”œâ”€ Backend Instance 1 (Railway)
      â”œâ”€ Backend Instance 2 (Railway)
      â””â”€ Backend Instance N (Railway)
```

### Database Scaling

```
PostgreSQL Primary (Write)
      â”‚
      â”œâ”€ Read Replica 1
      â”œâ”€ Read Replica 2
      â””â”€ Read Replica N
```

### Caching Strategy (Futuro)

```
Redis Cache
      â”‚
      â”œâ”€ Session cache
      â”œâ”€ Product catalog cache
      â”œâ”€ Menu cache (1 hour TTL)
      â””â”€ User profile cache
```

---

## ğŸ”§ ManutenÃ§Ã£o e OperaÃ§Ãµes

### Monitoring (Planejado)

- [ ] Sentry (Error tracking)
- [ ] Datadog/NewRelic (APM)
- [ ] Pingdom (Uptime monitoring)
- [ ] LogRocket (Session replay)

### Backup Strategy

- âœ… Database: Daily automated backups (Railway)
- [ ] Files/uploads: S3/Cloudinary
- [ ] Configuration: Git versioning

### Disaster Recovery

- **RPO:** 24 hours (database backup daily)
- **RTO:** 2 hours (restore from backup)

---

## ğŸ“š ReferÃªncias

- [Next.js Documentation](https://nextjs.org/docs)
- [Express.js Best Practices](https://expressjs.com/en/advanced/best-practice-performance.html)
- [Sequelize Documentation](https://sequelize.org/docs/v6/)
- [Socket.io Documentation](https://socket.io/docs/v4/)
- [Railway Documentation](https://docs.railway.app/)
- [Vercel Documentation](https://vercel.com/docs)

---

## ğŸ¨ C4 Model - Detailed Diagrams

### Level 1: System Context Diagram

```mermaid
C4Context
    title System Context Diagram - FLAME Lounge Bar v2.0

    Person(customer, "Cliente", "UsuÃ¡rio que faz pedidos,<br/>reservas e acumula cashback")
    Person(waiter, "Atendente", "Gerencia pedidos e mesas")
    Person(kitchen, "Cozinha", "Prepara pedidos")
    Person(admin, "Administrador", "Gerencia sistema completo")

    System(flame, "FLAME Lounge System", "Sistema completo de gestÃ£o<br/>de pedidos, cashback e reservas")

    System_Ext(twilio, "Twilio", "VerificaÃ§Ã£o por SMS")
    System_Ext(google, "Google OAuth", "AutenticaÃ§Ã£o social")
    System_Ext(stripe, "Stripe", "Processamento de pagamentos")
    System_Ext(railway_db, "Railway PostgreSQL", "Banco de dados")
    System_Ext(vercel_cdn, "Vercel CDN", "Hospedagem frontend")

    Rel(customer, flame, "Faz pedidos, reservas,<br/>usa cashback", "HTTPS/WebSocket")
    Rel(waiter, flame, "Gerencia pedidos,<br/>atende mesas", "HTTPS/WebSocket")
    Rel(kitchen, flame, "Visualiza e atualiza<br/>status dos pedidos", "WebSocket")
    Rel(admin, flame, "Administra produtos,<br/>usuÃ¡rios, relatÃ³rios", "HTTPS")

    Rel(flame, twilio, "Envia cÃ³digos SMS", "REST API")
    Rel(flame, google, "Autentica usuÃ¡rios", "OAuth 2.0")
    Rel(flame, stripe, "Processa pagamentos", "REST API")
    Rel(flame, railway_db, "Persiste dados", "TCP/PostgreSQL")
    Rel(vercel_cdn, flame, "Serve aplicaÃ§Ã£o", "HTTPS")

    UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")
```

### Level 2: Container Diagram

```mermaid
C4Container
    title Container Diagram - FLAME Lounge Bar

    Person(user, "UsuÃ¡rio", "Cliente, Atendente,<br/>Cozinha ou Admin")

    Container(webapp, "Web Application", "Next.js 14, React 18", "PWA instalÃ¡vel com suporte<br/>offline, SSR/SSG, optimistic UI")
    Container(api, "API Backend", "Node.js 18, Express 4", "REST API + WebSocket server<br/>com autenticaÃ§Ã£o JWT")
    ContainerDb(db, "Database", "PostgreSQL 16", "Armazena usuÃ¡rios, pedidos,<br/>produtos, cashback, reservas")
    ContainerDb(cache, "Cache Layer", "Redis 7", "Cache de sessÃµes, produtos,<br/>consultas frequentes")
    Container(files, "File Storage", "Railway Volumes", "Imagens de produtos,<br/>avatares, uploads")

    System_Ext(push, "Push Service", "Web Push API")
    System_Ext(sms, "SMS Gateway", "Twilio")
    System_Ext(payment, "Payment Gateway", "Stripe")

    Rel(user, webapp, "Usa", "HTTPS")
    Rel(webapp, api, "Faz chamadas", "JSON/HTTPS, WebSocket")
    Rel(api, db, "LÃª/Escreve", "TCP/SQL")
    Rel(api, cache, "Consulta cache", "Redis Protocol")
    Rel(api, files, "Upload/Download", "File System")
    Rel(api, push, "Envia notificaÃ§Ãµes", "Web Push")
    Rel(api, sms, "Envia SMS", "REST API")
    Rel(api, payment, "Processa pagamentos", "REST API")

    UpdateLayoutConfig($c4ShapeInRow="2", $c4BoundaryInRow="1")
```

### Level 3: Component Diagram - Backend API

```mermaid
C4Component
    title Component Diagram - Backend API (Express.js)

    Container(webapp, "Web Application", "Next.js")

    Container_Boundary(api, "API Backend") {
        Component(routes, "Routes", "Express Router", "50+ endpoints organizados<br/>por recurso")
        Component(controllers, "Controllers", "JavaScript", "authController, orderController,<br/>productController, etc (15+)")
        Component(services, "Business Logic", "JavaScript", "authService, orderService,<br/>cashbackService, etc (16+)")
        Component(models, "Data Models", "Sequelize", "User, Order, Product,<br/>OrderItem, etc (18 models)")
        Component(middleware, "Middleware Chain", "Express", "auth, validation, sanitization,<br/>rateLimit, errorHandler")
        Component(socket, "Socket.IO Server", "Socket.IO 4.7", "Real-time events:<br/>orders, kitchen, tracking")
        Component(jobs, "Background Jobs", "node-cron", "Daily reports, cashback expiry,<br/>reservation reminders (7 jobs)")
    }

    ContainerDb(db, "PostgreSQL", "Database")
    ContainerDb(cache, "Redis", "Cache")

    Rel(webapp, routes, "HTTP Requests", "JSON/REST")
    Rel(webapp, socket, "WebSocket", "Real-time")
    Rel(routes, middleware, "Passa por", "Chain")
    Rel(middleware, controllers, "Chama", "Function call")
    Rel(controllers, services, "Usa", "Function call")
    Rel(services, models, "CRUD ops", "Sequelize ORM")
    Rel(models, db, "SQL queries", "TCP/PostgreSQL")
    Rel(services, cache, "Cache ops", "Redis")
    Rel(jobs, services, "Executa", "Scheduled")

    UpdateLayoutConfig($c4ShapeInRow="2", $c4BoundaryInRow="1")
```

### Level 4: Component Diagram - Frontend

```mermaid
C4Component
    title Component Diagram - Frontend (Next.js 14)

    Person(user, "UsuÃ¡rio")

    Container_Boundary(webapp, "Web Application") {
        Component(pages, "Pages", "Next.js Routes", "/, /cardapio, /checkout,<br/>/pedidos, /perfil, /admin/* (51 pages)")
        Component(components, "React Components", "JSX", "ProductCard, CartItem, OrderCard,<br/>Layout, UI components (45+)")
        Component(stores, "State Management", "Zustand", "authStore, cartStore, orderStore,<br/>cashbackStore, etc (17 stores)")
        Component(apiServices, "API Services", "Axios", "authService, orderService,<br/>productService (REST clients)")
        Component(hooks, "Custom Hooks", "React Hooks", "useAuth, useCart, useOrders,<br/>useSocket, etc (6 hooks)")
        Component(sw, "Service Worker", "Workbox", "PWA caching strategies,<br/>offline support, push notifications")
    }

    Container(api, "API Backend", "Express.js")

    Rel(user, pages, "Navega", "Browser")
    Rel(pages, components, "Renderiza", "React")
    Rel(components, stores, "LÃª/Atualiza", "Subscribe")
    Rel(components, hooks, "Usa", "Hook call")
    Rel(hooks, apiServices, "Chama", "HTTP")
    Rel(apiServices, api, "REST + WebSocket", "JSON/HTTPS")
    Rel(stores, apiServices, "Chama", "HTTP")
    Rel(sw, api, "Background sync", "Fetch API")

    UpdateLayoutConfig($c4ShapeInRow="2", $c4BoundaryInRow="1")
```

### Deployment Diagram

```mermaid
graph TB
    subgraph "User Devices"
        A[Mobile Browser]
        B[Desktop Browser]
        C[Tablet Browser]
    end

    subgraph "Vercel Edge Network"
        D[Global CDN]
        E[Next.js App<br/>Auto-scaling]
        F[Static Assets<br/>Images, CSS, JS]
    end

    subgraph "Railway Production"
        G[Express API<br/>Node.js 18<br/>2GB RAM]
        H[Socket.IO Server<br/>WebSocket]
        I[Cron Jobs<br/>Background Tasks]
    end

    subgraph "Railway Database"
        J[PostgreSQL 16<br/>Primary]
        K[Automated Backups<br/>Daily]
    end

    subgraph "External Services"
        L[Twilio SMS]
        M[Google OAuth]
        N[Stripe Payments]
    end

    A --> D
    B --> D
    C --> D
    D --> E
    D --> F
    E --> G
    E --> H
    G --> J
    H --> J
    I --> J
    J --> K
    G --> L
    G --> M
    G --> N

    style E fill:#00c7b7
    style G fill:#7c3aed
    style J fill:#336791
    style D fill:#000
```

### Database Schema (ERD)

```mermaid
erDiagram
    USER ||--o{ ORDER : places
    USER ||--o{ RESERVATION : makes
    USER ||--o{ CASHBACK_HISTORY : has
    USER {
        uuid id PK
        string name
        string email UK
        string password
        string phone UK
        enum role
        enum tier
        decimal cashbackBalance
        datetime createdAt
        datetime updatedAt
    }

    ORDER ||--|{ ORDER_ITEM : contains
    ORDER }o--|| TABLE : assigned_to
    ORDER {
        uuid id PK
        uuid userId FK
        uuid tableId FK
        decimal total
        enum status
        enum paymentMethod
        decimal cashbackUsed
        datetime createdAt
    }

    ORDER_ITEM }o--|| PRODUCT : references
    ORDER_ITEM {
        uuid id PK
        uuid orderId FK
        uuid productId FK
        int quantity
        decimal price
    }

    PRODUCT }o--|| CATEGORY : belongs_to
    PRODUCT ||--o{ RECIPE_ITEM : has
    PRODUCT {
        uuid id PK
        string name
        text description
        decimal price
        uuid categoryId FK
        string image
        boolean isActive
        int stockQuantity
    }

    CATEGORY {
        uuid id PK
        string name
        text description
        string image
        int order
    }

    TABLE ||--o{ RESERVATION : has
    TABLE {
        uuid id PK
        int number UK
        int capacity
        enum status
        string qrCode
    }

    RESERVATION {
        uuid id PK
        uuid userId FK
        uuid tableId FK
        date date
        time time
        int guests
        enum status
    }

    CASHBACK_HISTORY {
        uuid id PK
        uuid userId FK
        uuid orderId FK
        decimal amount
        enum type
        datetime expiresAt
        datetime createdAt
    }

    INGREDIENT ||--o{ RECIPE_ITEM : used_in
    INGREDIENT {
        uuid id PK
        string name
        string unit
        decimal quantity
        decimal minStock
    }

    RECIPE_ITEM {
        uuid productId FK
        uuid ingredientId FK
        decimal quantity
    }
```

---

## ğŸ”’ Security Architecture - Deep Dive

### 11 Security Layers

```mermaid
graph TD
    A[1. HTTPS/TLS] --> B[2. CORS + Origin Check]
    B --> C[3. Rate Limiting]
    C --> D[4. Security Headers<br/>Helmet.js]
    D --> E[5. Input Sanitization<br/>XSS Protection]
    E --> F[6. JWT Authentication<br/>+ Token Rotation]
    F --> G[7. RBAC Authorization<br/>Role-based Access]
    G --> H[8. CSRF Protection<br/>Double Submit Cookie]
    H --> I[9. SQL Injection Protection<br/>ORM Prepared Statements]
    I --> J[10. Password Hashing<br/>bcrypt 12 rounds]
    J --> K[11. Audit Logging<br/>+ Monitoring]

    style A fill:#e3342f
    style F fill:#f6993f
    style K fill:#38c172
```

### Security Headers (Helmet.js)

```javascript
// ConfiguraÃ§Ã£o aplicada automaticamente
{
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'", "'unsafe-inline'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
      connectSrc: ["'self'", "wss:", "https:"]
    }
  },
  hsts: {
    maxAge: 31536000,
    includeSubDomains: true,
    preload: true
  },
  frameguard: { action: 'deny' },
  noSniff: true,
  xssFilter: true
}
```

### Rate Limiting Strategy

| Endpoint | Limit | Window | Reason |
|----------|-------|--------|--------|
| `/api/auth/login` | 5 req | 15 min | Brute force protection |
| `/api/auth/register` | 3 req | 1 hour | Account spam prevention |
| `/api/orders` | 20 req | 1 min | Order spam prevention |
| `/api/*` (global) | 500 req | 15 min | DoS protection |
| `/api/products` (GET) | 100 req | 1 min | Cache abuse prevention |

---

## âš¡ Performance Architecture

### Caching Strategy with Redis

```mermaid
graph LR
    A[Request] --> B{Cache Hit?}
    B -->|Yes TTL valid| C[Return from Redis]
    B -->|No/Expired| D[Query Database]
    D --> E[Store in Redis]
    E --> F[Return to Client]
    C --> F

    style B fill:#f6993f
    style C fill:#38c172
    style D fill:#3490dc
```

### Cache TTL Configuration

| Resource | TTL | Invalidation Strategy |
|----------|-----|----------------------|
| User profile | 10 min | On update/logout |
| Product catalog | 5 min | On product CRUD |
| Menu categories | 10 min | On category CRUD |
| Order details | 1 min | On status update |
| Cashback balance | 2 min | On transaction |
| Public pages | 1 hour | Manual purge |

### Database Indexes Strategy

**User Model (9 indexes):**
```sql
CREATE INDEX idx_user_email ON users(email);
CREATE INDEX idx_user_phone ON users(phone);
CREATE INDEX idx_user_role ON users(role);
CREATE INDEX idx_user_tier ON users(tier);
CREATE INDEX idx_user_created_at ON users(created_at);
CREATE INDEX idx_user_cashback ON users(cashback_balance);
CREATE UNIQUE INDEX idx_user_email_unique ON users(email);
CREATE UNIQUE INDEX idx_user_phone_unique ON users(phone);
CREATE INDEX idx_user_active ON users(is_active);
```

**Product Model (9 indexes):**
```sql
CREATE INDEX idx_product_category ON products(category_id);
CREATE INDEX idx_product_active ON products(is_active);
CREATE INDEX idx_product_price ON products(price);
CREATE INDEX idx_product_created_at ON products(created_at);
CREATE INDEX idx_product_stock ON products(stock_quantity);
CREATE INDEX idx_product_name ON products(name);
CREATE INDEX idx_product_category_active ON products(category_id, is_active);
CREATE INDEX idx_product_search ON products USING gin(to_tsvector('portuguese', name || ' ' || description));
CREATE UNIQUE INDEX idx_product_slug ON products(slug);
```

### Query Optimization Example

**Before (N+1 Query Problem):**
```javascript
// âŒ 1 query + N queries (6-20 extra queries)
const orders = await Order.findAll();
for (const order of orders) {
  order.items = await OrderItem.findAll({ where: { orderId: order.id } });
  order.user = await User.findByPk(order.userId);
}
// Response time: ~450ms
```

**After (Optimized with includes):**
```javascript
// âœ… Single optimized query with joins
const orders = await Order.findAll({
  include: [
    { model: OrderItem, include: [Product] },
    { model: User, attributes: ['id', 'name', 'email'] },
    { model: Table }
  ]
});
// Response time: ~75ms (6x faster!)
```

---

## ğŸ“Š Data Flow Diagrams

### Complete Order Creation Flow

```mermaid
sequenceDiagram
    participant C as Cliente
    participant F as Frontend
    participant A as API Backend
    participant D as Database
    participant S as Socket.IO
    participant K as Cozinha Display

    C->>F: Adiciona itens ao carrinho
    F->>F: Atualiza cartStore (Zustand)
    C->>F: Clica "Finalizar Pedido"
    F->>A: POST /api/orders<br/>{items, tableId, paymentMethod}

    A->>A: Valida JWT token
    A->>A: Valida input (express-validator)
    A->>D: BEGIN TRANSACTION
    A->>D: SELECT products WHERE id IN (...)
    A->>A: Verifica estoque disponÃ­vel
    A->>A: Calcula total + cashback (tier-based)
    A->>D: INSERT INTO orders
    A->>D: INSERT INTO order_items (bulk)
    A->>D: UPDATE products SET stock = stock - qty
    A->>D: INSERT INTO cashback_history
    A->>D: UPDATE users SET cashback_balance
    A->>D: COMMIT TRANSACTION

    A->>S: emit('order:created', orderData)
    A->>S: emit('kitchen:new_order', orderData)
    A-->>F: 201 Created {orderId, total}

    S->>K: Real-time notification
    S->>F: Real-time update

    F->>F: Limpa cartStore
    F->>F: Atualiza orderStore
    F->>C: Redireciona /pedidos/:orderId
    F->>S: Conecta socket tracking

    Note over F,K: Pedido agora visÃ­vel<br/>em tempo real
```

### Cashback Calculation Flow

```mermaid
graph TD
    A[Pedido Finalizado<br/>Total: R$ 100] --> B{UsuÃ¡rio autenticado?}
    B -->|NÃ£o| Z[Sem cashback]
    B -->|Sim| C[Busca tier do usuÃ¡rio]

    C --> D{Qual tier?}
    D -->|Bronze| E[Calcula 2%<br/>= R$ 2,00]
    D -->|Silver| F[Calcula 5%<br/>= R$ 5,00]
    D -->|Gold| G[Calcula 8%<br/>= R$ 8,00]
    D -->|Platinum| H[Calcula 10%<br/>= R$ 10,00]

    E --> I[Cria CashbackHistory]
    F --> I
    G --> I
    H --> I

    I --> J[Atualiza User.cashbackBalance]
    J --> K[Verifica mudanÃ§a de tier<br/>baseado em total gasto]

    K --> L{Mudou de tier?}
    L -->|Sim| M[Atualiza User.tier<br/>Envia notificaÃ§Ã£o]
    L -->|NÃ£o| N[Envia notificaÃ§Ã£o<br/>de cashback ganho]

    M --> O[Define expiresAt<br/>+90 dias]
    N --> O

    O --> P[Retorna ao cliente]

    style D fill:#f6993f
    style L fill:#e3342f
    style P fill:#38c172
```

---

## ğŸ“ˆ Scalability Considerations

### Current Capacity

| Metric | Current | Maximum | Scaling Point |
|--------|---------|---------|---------------|
| Concurrent users | ~50 | 500 | Add load balancer |
| Requests/second | ~100 | 1000 | Horizontal scaling |
| Database connections | 20 | 100 | Connection pooling |
| WebSocket connections | ~50 | 500 | Socket.IO cluster |
| Storage | 5 GB | 50 GB | Add CDN for images |

### Horizontal Scaling Strategy

**Phase 1: Single Instance (Current)**
```
[Vercel] â†’ [Railway Instance 1] â†’ [PostgreSQL]
```

**Phase 2: Load Balanced (500-1000 users)**
```
                    â”Œâ†’ [Railway Instance 1] â”
[Vercel] â†’ [LB] â”€â”€â”€â”€â”¤                        â”œâ†’ [PostgreSQL Primary]
                    â””â†’ [Railway Instance 2] â”˜       â†“
                                                [Read Replica]
```

**Phase 3: Microservices (1000+ users)**
```
[Vercel] â†’ [API Gateway]
              â”œâ†’ [Auth Service]
              â”œâ†’ [Order Service]
              â”œâ†’ [Payment Service]
              â”œâ†’ [Notification Service]
              â””â†’ [Analytics Service]
                        â†“
              [PostgreSQL Cluster]
              [Redis Cluster]
              [Message Queue - RabbitMQ]
```

### Database Scaling Strategy

**Read Scaling:**
- Add PostgreSQL read replicas (up to 5)
- Route read queries to replicas
- Route write queries to primary

**Write Scaling:**
- Implement database sharding (by tenant/region)
- Add write-ahead logging (WAL)
- Consider NoSQL for high-write workloads (logs, analytics)

**Cache Scaling:**
- Implement Redis Cluster mode
- Add Redis Sentinel for high availability
- Use cache warming strategies

---

## ğŸš¨ Disaster Recovery & Business Continuity

### Backup Strategy

| Component | Frequency | Retention | Location | RTO | RPO |
|-----------|-----------|-----------|----------|-----|-----|
| PostgreSQL | Daily | 30 days | Railway | 2h | 24h |
| Redis | Hourly | 7 days | Railway | 30min | 1h |
| Code | On commit | Forever | GitHub | 10min | 0 |
| Env vars | Manual | Forever | 1Password | 1h | Manual |
| Static files | Daily | 90 days | S3/Cloudinary | 1h | 24h |

### Recovery Procedures

**Database Recovery:**
```bash
# 1. Identify backup point
railway database:backups list

# 2. Restore to timestamp
railway database:restore --backup=<backup-id>

# 3. Verify data integrity
railway run -- npm run db:verify

# 4. Update connection strings
railway variables:set DATABASE_URL=<new-url>
```

**Full System Recovery:**
1. Restore database from latest backup (2 hours)
2. Redeploy backend from Git (10 minutes)
3. Redeploy frontend from Git (5 minutes)
4. Verify health checks (5 minutes)
5. **Total RTO: ~2.5 hours**

---

## ğŸ“¡ Monitoring & Observability

### Health Check Endpoints

| Endpoint | Purpose | Success Criteria | Alert Threshold |
|----------|---------|------------------|-----------------|
| `/health` | Basic liveness | 200 OK | > 5s response |
| `/health/db` | Database connectivity | Connection OK | > 3s response |
| `/health/redis` | Cache connectivity | Connection OK | > 2s response |
| `/metrics` | Prometheus metrics | Metrics returned | N/A |

### Key Metrics to Monitor

**Application Metrics:**
- Request rate (req/s)
- Response time (p50, p95, p99)
- Error rate (4xx, 5xx)
- Active WebSocket connections
- Background job success rate

**Infrastructure Metrics:**
- CPU usage (%)
- Memory usage (%)
- Disk I/O (IOPS)
- Network bandwidth (Mbps)

**Business Metrics:**
- Orders created per hour
- Average order value (AOV)
- Cashback redemption rate
- User tier distribution
- Top products by revenue

### Alerting Rules

| Alert | Condition | Severity | Action |
|-------|-----------|----------|--------|
| High error rate | > 5% 5xx errors | Critical | Page on-call |
| Slow response | p95 > 3s | High | Investigate |
| Database down | Health check fails | Critical | Immediate recovery |
| Disk full | > 90% usage | High | Scale storage |
| High CPU | > 80% for 5min | Medium | Consider scaling |

---

## ğŸ”® Future Evolution

### Short-term (Q1 2026)

- [ ] Implement Redis caching layer (âœ… Implemented Sprint 58)
- [ ] Add comprehensive monitoring (Sentry, Datadog)
- [ ] Implement A/B testing framework
- [ ] Add GraphQL endpoint (optional)
- [ ] Improve mobile landscape layout
- [ ] Add load testing suite (Artillery/K6)

### Medium-term (Q2-Q3 2026)

- [ ] Migrate to Prisma ORM (from Sequelize)
- [ ] Implement microservices architecture
- [ ] Add internationalization (i18n)
- [ ] Implement feature flags (LaunchDarkly)
- [ ] Add advanced analytics (Mixpanel)
- [ ] Implement rate limiting per user tier

### Long-term (Q4 2026+)

- [ ] Multi-tenant support (franchise expansion)
- [ ] Mobile native apps (React Native)
- [ ] AI-powered recommendations
- [ ] Voice ordering integration
- [ ] Blockchain loyalty program
- [ ] Advanced inventory forecasting

---

**Ãšltima atualizaÃ§Ã£o:** 2026-01-17
**Por:** MANUS LIA v7.1 + Claude Sonnet 4.5
**VersÃ£o:** 2.1 (C4 Model Enhanced)
