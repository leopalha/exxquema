# ğŸ—ï¸ ARQUITETURA TÃ‰CNICA - FLAME LOUNGE

**VersÃ£o:** 2.0
**Ãšltima AtualizaÃ§Ã£o:** 2026-01-16
**Status:** ProduÃ§Ã£o

---

## ğŸ“‹ Ãndice

- [VisÃ£o Geral](#visÃ£o-geral)
- [Arquitetura de Alto NÃ­vel](#arquitetura-de-alto-nÃ­vel)
- [Stack TecnolÃ³gico](#stack-tecnolÃ³gico)
- [Frontend Architecture](#frontend-architecture)
- [Backend Architecture](#backend-architecture)
- [Database Architecture](#database-architecture)
- [Real-time Communication](#real-time-communication)
- [Security Architecture](#security-architecture)
- [Deployment Architecture](#deployment-architecture)
- [Fluxos de Dados](#fluxos-de-dados)
- [DecisÃµes Arquiteturais](#decisÃµes-arquiteturais)

---

## ğŸ¯ VisÃ£o Geral

O FLAME Lounge Ã© uma aplicaÃ§Ã£o **full-stack moderna** construÃ­da com arquitetura **cliente-servidor** separada, comunicaÃ§Ã£o **real-time** via WebSockets, e design **mobile-first** com suporte PWA.

### CaracterÃ­sticas Principais

- âœ… **SeparaÃ§Ã£o Front/Back** - Deploys independentes
- âœ… **Real-time** - Socket.io para updates instantÃ¢neos
- âœ… **Progressive Web App** - InstalÃ¡vel e funciona offline
- âœ… **RESTful API** - Arquitetura baseada em recursos
- âœ… **AutenticaÃ§Ã£o JWT** - Stateless e escalÃ¡vel
- âœ… **Database ORM** - Sequelize com migraÃ§Ãµes versionadas

---

## ğŸ›ï¸ Arquitetura de Alto NÃ­vel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAMADA DE USUÃRIOS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Clientes  â”‚   GarÃ§ons   â”‚   Cozinha    â”‚   Administradores   â”‚
â”‚  (Mobile)   â”‚  (Tablet)   â”‚   (KDS)      â”‚    (Desktop)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LOAD BALANCER                            â”‚
â”‚                    (Vercel Edge Network)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (Next.js 14)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ SSR/SSG Pages (50+ routes)                                   â”‚
â”‚  â€¢ React Components (45+)                                        â”‚
â”‚  â€¢ Zustand State Management (17 stores)                         â”‚
â”‚  â€¢ Service Worker (PWA)                                          â”‚
â”‚  â€¢ Socket.io Client (Real-time)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Gateway   â”‚
                    â”‚  (Express.js)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND (Express.js)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Controllers â”‚  â”‚   Services   â”‚  â”‚     Jobs     â”‚         â”‚
â”‚  â”‚    (API)     â”‚  â”‚  (Business)  â”‚  â”‚  (Cron)      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â–¼                  â–¼                  â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚     Auth     â”‚  â”‚    Socket    â”‚  â”‚  Webhooks    â”‚         â”‚
â”‚  â”‚ Middleware   â”‚  â”‚   Handler    â”‚  â”‚   (Stripe)   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA ACCESS LAYER (ORM)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sequelize ORM â€¢ 18 Models â€¢ Migrations â€¢ Associations          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATABASE (PostgreSQL)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Railway â€¢ Primary + Replica â€¢ Automated Backups                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL SERVICES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Stripe    â”‚   SendGrid   â”‚    Twilio    â”‚   Cloudinary     â”‚
â”‚  (Payments)  â”‚   (Email)    â”‚    (SMS)     â”‚   (Images)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Stack TecnolÃ³gico

### Frontend Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PRESENTATION LAYER               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Next.js 14.0.4 (React 18.2.0)             â”‚
â”‚ â€¢ App Router                               â”‚
â”‚ â€¢ SSR/SSG/ISR                              â”‚
â”‚ â€¢ Image Optimization                       â”‚
â”‚ â€¢ API Routes (if needed)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STATE MANAGEMENT                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Zustand 4.4.7                              â”‚
â”‚ â€¢ authStore                                â”‚
â”‚ â€¢ cartStore                                â”‚
â”‚ â€¢ orderStore                               â”‚
â”‚ â€¢ ... (17 stores total)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DATA FETCHING                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ React Query 3.39.3 + Axios 1.6.2           â”‚
â”‚ â€¢ Caching                                  â”‚
â”‚ â€¢ Retry logic                              â”‚
â”‚ â€¢ Optimistic updates                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI LAYER                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tailwind CSS 3.3.6                         â”‚
â”‚ â€¢ Utility-first                            â”‚
â”‚ â€¢ Responsive breakpoints                   â”‚
â”‚ â€¢ Custom design tokens                     â”‚
â”‚                                            â”‚
â”‚ Component Libraries:                       â”‚
â”‚ â€¢ Heroicons 2.0.18                         â”‚
â”‚ â€¢ Lucide React 0.544.0                     â”‚
â”‚ â€¢ Framer Motion 10.16.16                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Express.js 4.18.2                          â”‚
â”‚ â€¢ RESTful routes (~20)                     â”‚
â”‚ â€¢ Middleware chain                         â”‚
â”‚ â€¢ Error handling                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       AUTHENTICATION & SECURITY            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JWT (jsonwebtoken 9.0.2)                   â”‚
â”‚ bcryptjs 2.4.3                             â”‚
â”‚ Helmet 7.1.0                               â”‚
â”‚ express-rate-limit 7.1.5                   â”‚
â”‚ CORS                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BUSINESS LOGIC                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Services (16 modules)                      â”‚
â”‚ â€¢ OrderService                             â”‚
â”‚ â€¢ PaymentService                           â”‚
â”‚ â€¢ CashbackService                          â”‚
â”‚ â€¢ ... etc                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DATA LAYER                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Sequelize 6.35.2                           â”‚
â”‚ â€¢ Models (18)                              â”‚
â”‚ â€¢ Migrations (15)                          â”‚
â”‚ â€¢ Associations                             â”‚
â”‚ â€¢ Validations                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» Frontend Architecture

### Estrutura de DiretÃ³rios

```
frontend/src/
â”œâ”€â”€ pages/                    # Next.js Routes (51 pages)
â”‚   â”œâ”€â”€ index.js             # Landing page
â”‚   â”œâ”€â”€ cardapio/            # Menu pages
â”‚   â”œâ”€â”€ pedidos/             # Orders
â”‚   â”œâ”€â”€ reservas/            # Reservations
â”‚   â”œâ”€â”€ admin/               # Admin dashboard
â”‚   â””â”€â”€ staff/               # Staff area
â”‚
â”œâ”€â”€ components/              # React Components (45+)
â”‚   â”œâ”€â”€ Admin/              # Admin components
â”‚   â”œâ”€â”€ Auth/               # Login, Register
â”‚   â”œâ”€â”€ Cart/               # Shopping cart
â”‚   â”œâ”€â”€ Checkout/           # Payment flow
â”‚   â”œâ”€â”€ Landing/            # Home page
â”‚   â”œâ”€â”€ Menu/               # Menu display
â”‚   â”œâ”€â”€ Tracking/           # Order tracking
â”‚   â””â”€â”€ ui/                 # Base components (Button, Input, etc)
â”‚
â”œâ”€â”€ stores/                  # Zustand Stores (17)
â”‚   â”œâ”€â”€ authStore.js        # Authentication state
â”‚   â”œâ”€â”€ cartStore.js        # Shopping cart
â”‚   â”œâ”€â”€ orderStore.js       # Orders
â”‚   â”œâ”€â”€ reservationStore.js # Reservations
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ hooks/                   # Custom React Hooks (6)
â”‚   â”œâ”€â”€ useAuth.js
â”‚   â”œâ”€â”€ useCart.js
â”‚   â”œâ”€â”€ useSocket.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ services/                # API Clients
â”‚   â”œâ”€â”€ api.js              # Axios instance
â”‚   â”œâ”€â”€ authService.js
â”‚   â”œâ”€â”€ orderService.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ utils/                   # Utilities
â”‚   â”œâ”€â”€ formatters.js
â”‚   â”œâ”€â”€ validators.js
â”‚   â””â”€â”€ constants.js
â”‚
â””â”€â”€ styles/                  # Global styles
    â”œâ”€â”€ globals.css
    â””â”€â”€ tailwind.config.js
```

### Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PAGE COMPONENT                     â”‚
â”‚  (Next.js Route - SSR/SSG)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Data fetching (getServerSideProps)           â”‚
â”‚  â€¢ SEO metadata                                 â”‚
â”‚  â€¢ Layout composition                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CONTAINER COMPONENTS                   â”‚
â”‚  (Business Logic)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Zustand stores connection                    â”‚
â”‚  â€¢ React Query hooks                            â”‚
â”‚  â€¢ Event handlers                               â”‚
â”‚  â€¢ State management                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PRESENTATIONAL COMPONENTS                â”‚
â”‚  (Pure UI)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Props-based                                  â”‚
â”‚  â€¢ No business logic                            â”‚
â”‚  â€¢ Reusable                                     â”‚
â”‚  â€¢ Styled with Tailwind                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Management (Zustand)

```javascript
// Example: cartStore.js
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CART STORE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ State:                              â”‚
â”‚  â€¢ items: []                        â”‚
â”‚  â€¢ total: 0                         â”‚
â”‚  â€¢ isOpen: false                    â”‚
â”‚                                     â”‚
â”‚ Actions:                            â”‚
â”‚  â€¢ addItem(product, quantity)       â”‚
â”‚  â€¢ removeItem(productId)            â”‚
â”‚  â€¢ updateQuantity(id, qty)          â”‚
â”‚  â€¢ clearCart()                      â”‚
â”‚  â€¢ openCart() / closeCart()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Backend Architecture

### Estrutura de DiretÃ³rios

```
backend/src/
â”œâ”€â”€ models/                  # Sequelize Models (18)
â”‚   â”œâ”€â”€ User.js
â”‚   â”œâ”€â”€ Product.js
â”‚   â”œâ”€â”€ Order.js
â”‚   â”œâ”€â”€ OrderItem.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ controllers/             # Request Handlers (~15)
â”‚   â”œâ”€â”€ authController.js
â”‚   â”œâ”€â”€ orderController.js
â”‚   â”œâ”€â”€ productController.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ services/                # Business Logic (16)
â”‚   â”œâ”€â”€ authService.js
â”‚   â”œâ”€â”€ orderService.js
â”‚   â”œâ”€â”€ paymentService.js
â”‚   â”œâ”€â”€ cashbackService.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ routes/                  # Express Routes (~20)
â”‚   â”œâ”€â”€ index.js            # Route aggregator
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ orders.js
â”‚   â”œâ”€â”€ products.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ middlewares/             # Middleware Chain
â”‚   â”œâ”€â”€ auth.js             # JWT verification
â”‚   â”œâ”€â”€ validate.js         # Input validation
â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â””â”€â”€ rateLimit.js
â”‚
â”œâ”€â”€ migrations/              # Database Migrations (15)
â”‚   â”œâ”€â”€ 001-create-users.js
â”‚   â”œâ”€â”€ 002-create-products.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ jobs/                    # Scheduled Tasks (7)
â”‚   â”œâ”€â”€ stockAlerts.js
â”‚   â”œâ”€â”€ reservationReminders.js
â”‚   â”œâ”€â”€ cashbackExpiry.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ database/                # DB Configuration
â”‚   â”œâ”€â”€ config.js
â”‚   â””â”€â”€ connection.js
â”‚
â”œâ”€â”€ utils/                   # Helpers
â”‚   â”œâ”€â”€ logger.js
â”‚   â”œâ”€â”€ qrcode.js
â”‚   â””â”€â”€ notifications.js
â”‚
â””â”€â”€ server.js                # Entry Point
```

### Request Flow

```
1. HTTP Request
        â–¼
2. Rate Limiting Middleware
        â–¼
3. CORS Middleware
        â–¼
4. Body Parser
        â–¼
5. Route Matching
        â–¼
6. Auth Middleware (if protected)
        â–¼
7. Validation Middleware
        â–¼
8. Controller
        â–¼
9. Service (Business Logic)
        â–¼
10. Model (Database)
        â–¼
11. Response
```

### API Architecture (RESTful)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REST API ENDPOINTS                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ /api/auth                                      â”‚
â”‚  â”œâ”€ POST   /register                          â”‚
â”‚  â”œâ”€ POST   /login                             â”‚
â”‚  â”œâ”€ POST   /refresh                           â”‚
â”‚  â””â”€ POST   /logout                            â”‚
â”‚                                                â”‚
â”‚ /api/products                                  â”‚
â”‚  â”œâ”€ GET    /                                  â”‚
â”‚  â”œâ”€ GET    /:id                               â”‚
â”‚  â”œâ”€ POST   /           (admin)                â”‚
â”‚  â”œâ”€ PUT    /:id        (admin)                â”‚
â”‚  â””â”€ DELETE /:id        (admin)                â”‚
â”‚                                                â”‚
â”‚ /api/orders                                    â”‚
â”‚  â”œâ”€ GET    /                                  â”‚
â”‚  â”œâ”€ GET    /:id                               â”‚
â”‚  â”œâ”€ POST   /                                  â”‚
â”‚  â”œâ”€ PATCH  /:id/status                        â”‚
â”‚  â””â”€ DELETE /:id                               â”‚
â”‚                                                â”‚
â”‚ /api/reservations                              â”‚
â”‚  â”œâ”€ GET    /                                  â”‚
â”‚  â”œâ”€ GET    /:id                               â”‚
â”‚  â”œâ”€ POST   /                                  â”‚
â”‚  â”œâ”€ PATCH  /:id                               â”‚
â”‚  â””â”€ DELETE /:id                               â”‚
â”‚                                                â”‚
â”‚ /api/cashback                                  â”‚
â”‚  â”œâ”€ GET    /balance                           â”‚
â”‚  â”œâ”€ GET    /history                           â”‚
â”‚  â””â”€ POST   /redeem                            â”‚
â”‚                                                â”‚
â”‚ ... (20+ routes total)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Architecture

### Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤    Order     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Table     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  1:N    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   N:1   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚         â”‚ id           â”‚         â”‚ id          â”‚
â”‚ name        â”‚         â”‚ userId       â”‚         â”‚ number      â”‚
â”‚ email       â”‚         â”‚ tableId      â”‚         â”‚ capacity    â”‚
â”‚ password    â”‚         â”‚ total        â”‚         â”‚ status      â”‚
â”‚ phone       â”‚         â”‚ status       â”‚         â”‚ qrCode      â”‚
â”‚ role        â”‚         â”‚ createdAt    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ tier        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ cashback    â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ 1:N
       â”‚                      â–¼
       â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚  OrderItem   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Product   â”‚
       â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   N:1   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚               â”‚ id           â”‚         â”‚ id          â”‚
       â”‚               â”‚ orderId      â”‚         â”‚ name        â”‚
       â”‚               â”‚ productId    â”‚         â”‚ description â”‚
       â”‚               â”‚ quantity     â”‚         â”‚ price       â”‚
       â”‚               â”‚ price        â”‚         â”‚ categoryId  â”‚
       â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ image       â”‚
       â”‚                                        â”‚ isActive    â”‚
       â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1:N                                          â”‚
       â–¼                                              â”‚ N:1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â–¼
â”‚ Reservation  â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚  Category   â”‚
â”‚ id           â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ userId       â”‚                              â”‚ id          â”‚
â”‚ tableId      â”‚                              â”‚ name        â”‚
â”‚ date         â”‚                              â”‚ description â”‚
â”‚ time         â”‚                              â”‚ image       â”‚
â”‚ guests       â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ status       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CashbackHist  â”‚         â”‚  Ingredient  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚         â”‚ id           â”‚
â”‚ userId       â”‚         â”‚ name         â”‚
â”‚ orderId      â”‚         â”‚ unit         â”‚
â”‚ amount       â”‚         â”‚ quantity     â”‚
â”‚ type         â”‚         â”‚ minStock     â”‚
â”‚ expiresAt    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                â”‚ N:M
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  RecipeItem  â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ productId    â”‚
                         â”‚ ingredientId â”‚
                         â”‚ quantity     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Models (18 total)

1. **User** - Clientes, garÃ§ons, admin
2. **Product** - Produtos do cardÃ¡pio
3. **Category** - Categorias de produtos
4. **Table** - Mesas do restaurante
5. **Order** - Pedidos
6. **OrderItem** - Itens dos pedidos
7. **Reservation** - Reservas de mesa
8. **HookahSession** - SessÃµes de narguilÃ©
9. **HookahFlavor** - Sabores de narguilÃ©
10. **Cashier** - Caixa
11. **CashierMovement** - MovimentaÃ§Ãµes do caixa
12. **CashbackHistory** - HistÃ³rico de cashback
13. **Campaign** - Campanhas de marketing
14. **Ingredient** - Ingredientes
15. **RecipeItem** - Receitas (produtos â†” ingredientes)
16. **InventoryMovement** - MovimentaÃ§Ã£o de estoque
17. **Message** - Mensagens/notificaÃ§Ãµes
18. **SplitPayment** - DivisÃ£o de conta
19. **InstagramCashback** - Cashback por Instagram
20. **PushSubscription** - InscriÃ§Ãµes push

---

## ğŸ”„ Real-time Communication

### Socket.io Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SOCKET.IO SERVER                    â”‚
â”‚            (Backend: Port 5000)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  Namespaces:                                 â”‚
â”‚  â”œâ”€ /orders    (Pedidos)                     â”‚
â”‚  â”œâ”€ /kitchen   (Cozinha)                     â”‚
â”‚  â”œâ”€ /tracking  (Rastreamento)                â”‚
â”‚  â””â”€ /admin     (Admin dashboard)             â”‚
â”‚                                              â”‚
â”‚  Events Emitted:                             â”‚
â”‚  â”œâ”€ order:created                            â”‚
â”‚  â”œâ”€ order:updated                            â”‚
â”‚  â”œâ”€ order:status_changed                     â”‚
â”‚  â”œâ”€ kitchen:new_order                        â”‚
â”‚  â””â”€ table:call_waiter                        â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–²         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SOCKET.IO CLIENTS                     â”‚
â”‚         (Frontend: Multiple)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Client Page         â”‚  Listens To           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Order Tracking      â”‚  order:status_changed â”‚
â”‚  Kitchen Dashboard   â”‚  kitchen:new_order    â”‚
â”‚  Admin Dashboard     â”‚  order:created        â”‚
â”‚  Waiter Tablet       â”‚  table:call_waiter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Real-time Flow Example: New Order

```
1. Cliente finaliza pedido (Frontend)
        â–¼
2. POST /api/orders (REST API)
        â–¼
3. Order salvo no Database
        â–¼
4. Socket.io emite eventos:
   â”œâ”€ "order:created" â†’ Admin Dashboard
   â”œâ”€ "kitchen:new_order" â†’ Kitchen Display
   â””â”€ "order:status_changed" â†’ Client Tracking
        â–¼
5. Clientes recebem updates em tempo real
```

---

## ğŸ” Security Architecture

### Authentication Flow (JWT)

```
1. User Login (email + password)
        â–¼
2. Backend valida credenciais
        â–¼
3. Gera JWT token (access + refresh)
        â–¼
4. Token armazenado no cookie httpOnly
        â–¼
5. Requests subsequentes incluem token no header
        â–¼
6. Middleware valida JWT em rotas protegidas
        â–¼
7. Se vÃ¡lido, anexa user ao req.user
```

### Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SECURITY LAYERS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ 1. Rate Limiting                           â”‚
â”‚    â€¢ 500 requests / 15min por IP          â”‚
â”‚    â€¢ ProteÃ§Ã£o contra brute force          â”‚
â”‚                                            â”‚
â”‚ 2. CORS                                    â”‚
â”‚    â€¢ Whitelist de origens permitidas      â”‚
â”‚    â€¢ Credentials habilitado               â”‚
â”‚                                            â”‚
â”‚ 3. Helmet                                  â”‚
â”‚    â€¢ Security headers (XSS, CSP, etc)     â”‚
â”‚                                            â”‚
â”‚ 4. Input Validation                        â”‚
â”‚    â€¢ express-validator                     â”‚
â”‚    â€¢ SanitizaÃ§Ã£o de inputs                â”‚
â”‚                                            â”‚
â”‚ 5. Password Hashing                        â”‚
â”‚    â€¢ bcryptjs (12 rounds)                 â”‚
â”‚                                            â”‚
â”‚ 6. JWT Authentication                      â”‚
â”‚    â€¢ Tokens com expiraÃ§Ã£o                 â”‚
â”‚    â€¢ Refresh token rotation               â”‚
â”‚                                            â”‚
â”‚ 7. SQL Injection Protection                â”‚
â”‚    â€¢ Sequelize ORM (prepared statements)  â”‚
â”‚                                            â”‚
â”‚ 8. HTTPS                                   â”‚
â”‚    â€¢ ForÃ§ado em produÃ§Ã£o                  â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš¢ Deployment Architecture

### Production Infrastructure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VERCEL (FRONTEND)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Edge Network (CDN global)                               â”‚
â”‚  â€¢ Auto-scaling                                            â”‚
â”‚  â€¢ SSL/TLS automÃ¡tico                                      â”‚
â”‚  â€¢ GitHub integration (CI/CD)                              â”‚
â”‚  â€¢ Environment variables                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                          â”‚ HTTPS
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CLIENTE (Browser/PWA)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼ REST API / WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RAILWAY (BACKEND)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Container:                                                â”‚
â”‚  â”œâ”€ Node.js 18                                             â”‚
â”‚  â”œâ”€ Express Server                                         â”‚
â”‚  â”œâ”€ Socket.io Server                                       â”‚
â”‚  â””â”€ Cron Jobs                                              â”‚
â”‚                                                            â”‚
â”‚  Features:                                                 â”‚
â”‚  â”œâ”€ Auto-scaling                                           â”‚
â”‚  â”œâ”€ Health checks                                          â”‚
â”‚  â”œâ”€ Rollback capability                                    â”‚
â”‚  â””â”€ GitHub integration (CI/CD)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RAILWAY POSTGRESQL DATABASE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Primary + Replica                                       â”‚
â”‚  â€¢ Automated backups (daily)                               â”‚
â”‚  â€¢ Connection pooling                                      â”‚
â”‚  â€¢ SSL enforced                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deployment Flow

```
Developer Push
    â–¼
GitHub Repository
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CI/CD Trigger  â”‚
â”‚  (GitHub Push)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Build & Test                 â”‚
â”‚    â€¢ npm install                â”‚
â”‚    â€¢ npm run lint               â”‚
â”‚    â€¢ npm test                   â”‚
â”‚    â€¢ npm run build              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Deploy                       â”‚
â”‚    Frontend â†’ Vercel            â”‚
â”‚    Backend â†’ Railway            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Health Check                 â”‚
â”‚    â€¢ /health endpoint           â”‚
â”‚    â€¢ Smoke tests                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
Production Live âœ…
```

---

## ğŸ“Š Fluxos de Dados

### Fluxo: Criar Pedido

```
[Cliente] â†’ [Frontend]
              â”‚
              â–¼
        Adiciona itens ao carrinho
              â”‚
              â–¼
        Clica em "Finalizar Pedido"
              â”‚
              â–¼
        POST /api/orders
              â”‚
              â–¼
         [Backend]
              â”‚
         1. Valida request
         2. Verifica estoque
         3. Calcula total + cashback
         4. Cria Order + OrderItems
         5. Atualiza estoque
         6. Emite Socket.io events
         7. Retorna order ID
              â”‚
              â–¼
         [Frontend]
              â”‚
         Limpa carrinho
         Redireciona para /pedidos/:id
         Conecta Socket.io (tracking)
              â”‚
              â–¼
         [Real-time Updates]
              â”‚
         â€¢ Status: "pending" â†’ "confirmed"
         â€¢ Status: "preparing" â†’ "ready"
         â€¢ NotificaÃ§Ã£o push
```

### Fluxo: Sistema de Cashback

```
[Cliente faz pedido de R$ 100]
              â”‚
              â–¼
    [Backend - PaymentService]
              â”‚
         1. Calcula cashback baseado no tier
            â€¢ Bronze: 2% = R$ 2
            â€¢ Silver: 5% = R$ 5
            â€¢ Gold: 8% = R$ 8
            â€¢ Platinum: 10% = R$ 10
              â”‚
         2. Cria registro CashbackHistory
              â”‚
         3. Atualiza User.cashbackBalance
              â”‚
         4. Verifica se mudou de tier
              â”‚
         5. Envia notificaÃ§Ã£o
              â”‚
              â–¼
    [Frontend - Cashback Badge]
              â”‚
         Exibe: "VocÃª ganhou R$ 5 de cashback!"
```

---

## ğŸ§© DecisÃµes Arquiteturais

### 1. Por que Next.js?

**DecisÃ£o:** Next.js 14 com App Router

**RazÃµes:**
- âœ… SSR/SSG out-of-the-box (SEO)
- âœ… Image optimization automÃ¡tica
- âœ… Code splitting automÃ¡tico
- âœ… API routes (se necessÃ¡rio)
- âœ… Vercel deployment otimizado
- âœ… DX excelente

**Alternativas consideradas:**
- âŒ Create React App (sem SSR)
- âŒ Remix (mais novo, menos maduro)
- âŒ Gatsby (overkill para nÃ£o-blog)

### 2. Por que Zustand para state?

**DecisÃ£o:** Zustand 4.4.7

**RazÃµes:**
- âœ… API simples e minimalista
- âœ… Sem boilerplate (vs Redux)
- âœ… Performance excelente
- âœ… Bundle size pequeno (3KB)
- âœ… Suporta persist middleware

**Alternativas consideradas:**
- âŒ Redux (muito boilerplate)
- âŒ MobX (menos popular)
- âŒ Jotai/Recoil (atomic, complexo)

### 3. Por que Sequelize?

**DecisÃ£o:** Sequelize 6.35.2

**RazÃµes:**
- âœ… ORM maduro e estÃ¡vel
- âœ… Suporta PostgreSQL + SQLite
- âœ… Migrations versionadas
- âœ… Associations complexas
- âœ… DocumentaÃ§Ã£o extensa

**Alternativas consideradas:**
- âŒ Prisma (migraÃ§Ã£o futura possÃ­vel)
- âŒ TypeORM (menos maduro)
- âŒ Knex.js (query builder, nÃ£o ORM)

### 4. Por que Socket.io?

**DecisÃ£o:** Socket.io 4.7.5

**RazÃµes:**
- âœ… Real-time bidirecional
- âœ… Fallback automÃ¡tico (polling)
- âœ… Room/namespace support
- âœ… Reconnection automÃ¡tica
- âœ… Binary data support

**Alternativas consideradas:**
- âŒ Server-Sent Events (unidirecional)
- âŒ WebSockets puro (sem fallback)
- âŒ Firebase (vendor lock-in)

### 5. Por que Railway?

**DecisÃ£o:** Railway para backend + database

**RazÃµes:**
- âœ… PostgreSQL integrado
- âœ… Deploy automÃ¡tico via Git
- âœ… Logs e monitoring
- âœ… VariÃ¡veis de ambiente
- âœ… PreÃ§o competitivo

**Alternativas consideradas:**
- âŒ Heroku (mais caro)
- âŒ AWS (mais complexo)
- âŒ DigitalOcean (requer mais setup)

---

## ğŸ“ˆ Escalabilidade

### Horizontal Scaling

```
Load Balancer
      â”‚
      â”œâ”€ Frontend Instance 1 (Vercel Edge)
      â”œâ”€ Frontend Instance 2 (Vercel Edge)
      â””â”€ Frontend Instance N (Vercel Edge)

      â”œâ”€ Backend Instance 1 (Railway)
      â”œâ”€ Backend Instance 2 (Railway)
      â””â”€ Backend Instance N (Railway)
```

### Database Scaling

```
PostgreSQL Primary (Write)
      â”‚
      â”œâ”€ Read Replica 1
      â”œâ”€ Read Replica 2
      â””â”€ Read Replica N
```

### Caching Strategy (Futuro)

```
Redis Cache
      â”‚
      â”œâ”€ Session cache
      â”œâ”€ Product catalog cache
      â”œâ”€ Menu cache (1 hour TTL)
      â””â”€ User profile cache
```

---

## ğŸ”§ ManutenÃ§Ã£o e OperaÃ§Ãµes

### Monitoring (Planejado)

- [ ] Sentry (Error tracking)
- [ ] Datadog/NewRelic (APM)
- [ ] Pingdom (Uptime monitoring)
- [ ] LogRocket (Session replay)

### Backup Strategy

- âœ… Database: Daily automated backups (Railway)
- [ ] Files/uploads: S3/Cloudinary
- [ ] Configuration: Git versioning

### Disaster Recovery

- **RPO:** 24 hours (database backup daily)
- **RTO:** 2 hours (restore from backup)

---

## ğŸ“š ReferÃªncias

- [Next.js Documentation](https://nextjs.org/docs)
- [Express.js Best Practices](https://expressjs.com/en/advanced/best-practice-performance.html)
- [Sequelize Documentation](https://sequelize.org/docs/v6/)
- [Socket.io Documentation](https://socket.io/docs/v4/)
- [Railway Documentation](https://docs.railway.app/)
- [Vercel Documentation](https://vercel.com/docs)

---

**Ãšltima atualizaÃ§Ã£o:** 2026-01-16
**Por:** MANUS LIA v7.1
**VersÃ£o:** 2.0
